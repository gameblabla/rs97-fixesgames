NP2 for PSP ver0.37
                                                                     2009/11/05
                                                           ひっそりぃ(hissorii)

NEC PC-9801シリーズをエミュレートする
Neko Project II(http://www.yui.ne.jp/np2/)をPSPに移植してみました。
それなりに手抜きです。
元にしたソースのバージョンはver0.81a。

オリジナル移植者のsakahiさんから引き継ぎ
Ver0.34より、ひっそりぃが開発しています。

0) 免責

  本ソフトウェアを使用したことによる、いかなる損害も作者は責任を負いません。
  あくまでも自己責任での使用をお願い致します。

1) 準備

   ・インストールディレクトリ

   「PSP\GAME\np2」など。np2の部分はお好みで変更可能。

   ・日本語フォントの準備

   Neko Project II公式サイトにてMAKEFONT32を入手してください。NP2 Toolの下。
   ( http://retropc.net/yui/np2tool/index.html )

   MAKEFONT32で、
     FontFace: MS ゴシック
     FontType: PC-98 Bitmap
   を選んでfont.bmpを作成し、インストールディレクトリに置く。
   FontFace: はMS明朝でもよいかも。

2) キー操作

   右トリガー: ソフトキーボードon/off
   左トリガー: メニューon/off

   SELECT: キーコンフィグ選択モードon/off
   START:  コンフィグキーモード <-> pc98マウスモード 切替

   モード            コンフィグキー / pc98マウス
   ----------------------------------------------------
   △              : コンフィグ依存 / コンフィグ依存
   □              : コンフィグ依存 / コンフィグ依存
   ○              : コンフィグ依存 / マウス左クリック (*1)
   ×              : コンフィグ依存 / マウス右クリック (*1)
   デジタルパッド↑: コンフィグ依存 / マウス移動
   デジタルパッド→: コンフィグ依存 / マウス移動
   デジタルパッド←: コンフィグ依存 / マウス移動
   デジタルパッド↓: コンフィグ依存 / マウス移動
   アナログパッド  : 未使用         / マウス移動
   ----------------------------------------------------

   (*1) menu->psp->Swap 98mouse buttonsをチェックすることで、
        pc98マウスモード時に○をマウス右クリック、×をマウス左クリックに
        変更できます。変更設定は保存されます。

   2.1) キーコンフィグ

   キーコンフィグは、psp_key.txtというファイルで行います。
   EBOOT.PBPと同じディレクトリに置いてください。
   標準で、以下の様なpsp_key.txtを同梱しています。

[KeySetting]
up = UP
down = DOWN
left = LEFT
right = RIGHT
circle = RET
cross = ESC
triangle = SHIFT
square = SPC
mm_triangle = SHIFT
mm_square = SPC
comment = "基本セッティング(カーソルキー移動)"

[KeySetting]
up = [8]
down = [2]
left = [4]
right = [6]
circle = RET
cross = ESC
triangle = SHIFT
square = SPC
mm_triangle = SHIFT
mm_square = SPC
comment = "基本セッティング(テンキー移動)"

   ・up/down/left/rightはそれぞれデジタルパッドが押された時の設定
   ・circle/cross/triangle/squareはそれぞれ○/×/△/□が押された時の設定
   ・mm_triangle/mm_squareはそれぞれpc98マウスモード時に△/□が押された時の設定
   ・commentはPSPでのキーコンフィグ設定選択時に表示されるコメント。半角の""で
     くくってください。漢字を使う場合はSJISで。
   ・改行コードは、DOS(Windows), MAC, Unix系に対応した気がします。

   KeySettingはとりあえずいくつでも追加できます。

   設定できるキーは以下のとおり。

   1 2 3 4 5 6 7 8 9 0 (非10キー)
   A B C D E F G H I J K L M N O P Q R S T U V W X Y Z
   - ^ \ @ [ ; : ] , . / _
   ESC BS TAB RET SPC XFER RLUP RLDN INS DEL HOME HELP NFER
   STOP COPY SHIFT(左シフト) RSHIFT(右シフト) CAPS KANA GRPH CTRL
   LWIN(左WINキー) RWIN(右WINキー) APP
   UP LEFT RIGHT DOWN (カーソルキー)
   [-] [/] [*] [+] [=] [,] [.] (10キー)
   [0] [1] [2] [3] [4] [5] [6] [7] [8] [9] (10キー)
   VF1 VF2 VF3 VF4 VF5 (ファンクションキー)
   F1 F2 F3 F4 F5 F6 F7 F8 F9 F10 (ファンクションキー)

   2.2)

   カーソルのおおまかな移動はアナログで、細かい移動はデジタルがやりやすい

   2.3) ソフトキーボードモード時のキー操作

        デジタルパッド: キーの選択
        アナログパッド: ソフトキーボードそのものの移動
        ○: キーの入力

3) 画面サイズ

   menu->pspのから以下の画面サイズを選択可能です。

   ・432x270 (縮小率 0.675倍, 左右24ドットずつ, 上下1ドットずつ黒画面領域)   
   ・480x272 (横長ワイド画面 縮小率 W*0.75, H*0.68)
   ・480x300 (縮小率 0.75倍, 上下が14ドットずつ切れる)
   ・640x400 (等倍, 右160ドット, 下128ドット切れる)

   ・480x300, 640x400の場合はPSPの画面(480x272)に収まらないので、
     コンフィグキーモード時のアナログパッドを使って画面全体を見渡せます。
   ・選択した画面設定は保存されます。

4) PSP動作クロック設定

   ・menu->psp->Clock 333MHzをチェックすると333MHz、
     チェックをはずすと222MHzで動作します。
   ・選択した設定は保存されます。

5) 今後の予定(は未定...)

   ・日本語ファイルの読み込み対応
   ・UIの見直し
   ・もろもろのバグ修正
       :
   ・速度改善

6) アイコン

  pochi style (http://pochistyle.pspwire.net/index.html)より、
  pochiさん作成のアイコンを使用させていただきました。

7) フォント

  フォントの一部に「ナガ10」フォントを使用しています。

8) 変更履歴

ver0.37
・画面サイズ640x480の場合に、横512ドット付近に縦線が入るバグ(ver0.35にて
  エンバグしました)の修正
・pc98マウスモード時に、PSPの○ボタンにマウス右クリック、
  PSPの×ボタンにマウス左クリックを割当て可能にしました
・ちょこっと高速化しました

ver0.36
・画面サイズ480x300の場合に、アナログパッドでスクロールさせても最下部が
  表示されなかった問題を修正

ver0.35
・キーコンフィグの追加

ver0.34
・BEEP/PSG音源が正しく再生されていなかった問題を修正
・起動時の「ぴぽっ」がなるようになりました。

ver0.33
・FM音源が正しく再生されていなかった問題を修正

ver0.32
・メニューが見やすくなりました...
・メニュー操作時のもたつきをなくすため、メニュー表示時はエミュレーションを
  停止するように変更
・640x400などで表示領域をずらしている時も、常にメニューがPSP画面上部に
  固定表示されるよう修正
・ファイル選択メニューで、拡張子が小文字のファイルが表示されなかった問題を修正
・PC98マウスモードで、カーソルの左/上方向移動の加速が止まらなかった問題を修正
・pochi style (http://pochistyle.pspwire.net/index.html)のpochiさん作成の
  アイコンを使用するようにした
・開発環境をPSPSDKに移行(の途中)
・実行ファイルEBOOT.PBPのサイズがかなり小さくなりました

ver0.3
・大画面サポート (432x270, 480x272(wide), 480x300, 640x400)
・ソフトウェアキーボード強化
・マウスカーソル処理(たまに画面にごみが出る)を修正
・動作Clock(222/333MHz)をメニューに移動。clock設定の保存をサポート。
・メニューのフォントが見にくくなりました...

ver0.21
・FDIイメージを読み込めるよう修正
・終了処理で失敗することがあったのを修正
・np2のmenu->emulate->Exitまたはメニューバーのxボタンで
  ホームへ戻れるように修正
・np2のmenu->emulate->Reset with HELP keyでリセット後に
  システムセットアップメニューへ入れるように修正
・簡易コンフィグキーモードの追加

ver0.2
・音が出るようになりました
・終了処理(ホームへ戻れる, iniファイルの保存)
・インストールディレクトリのnp2決めうち制限を解除
・現在時刻取得をしていなかったのを修正(自前time()/localtime()作成)
・なんちゃってmalloc()/free()をやめた
  (sceKernel〜を用いた自前malloc()/free()作成)
・ダイアログの文字化けを修正(自前sprintf()の作成)
・ベースのソースをver0.81→ver0.81aに変更
・ソース公開

ver0.1
・とりあえずリリース

8) PSP版作者Webサイト

●ひっそりぃ(hissorii)
News系blog: ひっそりぃドットコム 
http://hissorii.blog45.fc2.com/

開発系blog: えみゅはに - Emulator Hacking 日記
http://emuhani.seesaa.net/

●sakahi
http://sakahi.hp.infoseek.co.jp/
